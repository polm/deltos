// Generated by LiveScript 1.4.0
(function(){
  var ref$, launchEditor, deltosHome, getFilename, readConfig, editConfig, fs, init, config, newNote, newDaily, dumpTsv, dumpTsvTagged, dumpTodos, grepEntries, writeDaily, writePost, editPost, render, buildSite, buildPrivateReference, dumpJson, commands, addCommand, func, e, slice$ = [].slice;
  ref$ = require('./util'), launchEditor = ref$.launchEditor, deltosHome = ref$.deltosHome, getFilename = ref$.getFilename, readConfig = ref$.readConfig, editConfig = ref$.editConfig;
  fs = require('fs');
  init = function(){
    var mkdirp;
    mkdirp = require('mkdirp');
    mkdirp.sync(deltosHome + 'by-id');
    mkdirp.sync(deltosHome + 'site');
    return mkdirp.sync(deltosHome + 'private');
  };
  config = readConfig();
  ref$ = require('./entries'), newNote = ref$.newNote, newDaily = ref$.newDaily, dumpTsv = ref$.dumpTsv, dumpTsvTagged = ref$.dumpTsvTagged, dumpTodos = ref$.dumpTodos, grepEntries = ref$.grepEntries;
  writeDaily = function(){
    return launchEditor(newDaily());
  };
  writePost = function(it){
    return launchEditor(newNote(it));
  };
  editPost = function(it){
    return launchEditor(it);
  };
  ref$ = require('./html'), render = ref$.render, buildSite = ref$.buildSite, buildPrivateReference = ref$.buildPrivateReference, dumpJson = ref$.dumpJson;
  commands = [];
  addCommand = function(name, desc, func){
    func.command = name;
    func.desc = desc;
    name = name.split(" ")[0];
    return commands[name] = func;
  };
  addCommand('search', "search", function(){
    var launchSearch;
    launchSearch = require('./util').launchSearch;
    return launchSearch();
  });
  addCommand("init", "Set up DELTOS_HOME", init);
  addCommand("config", "Edit deltos config file", editConfig);
  addCommand("new [title...]", "Create a note and print the filename", function(){
    var args;
    args = slice$.call(arguments);
    return console.log(newNote(args.join(' ')));
  });
  addCommand("daily", "Create a daily note and open in $EDITOR", function(){
    return writeDaily();
  });
  addCommand("post [title...]", "Start a new post in $EDITOR", function(){
    var args;
    args = slice$.call(arguments);
    return writePost(args.join(' '));
  });
  addCommand("edit [id]", "Edit an existing post", function(it){
    return editPost(getFilename(it));
  });
  addCommand("render [id]", "Render [id] as HTML", function(it){
    return console.log(render(it));
  });
  addCommand("grep [pattern]", "Grep body of deltos documents", function(pat){
    return grepEntries(pat).map(function(it){
      return console.log(it);
    });
  });
  addCommand('build-site', "Build static HTML", function(){
    buildPrivateReference();
    return buildSite();
  });
  addCommand('json', "Dump all entries to JSON", function(){
    return console.log(dumpJson());
  });
  addCommand('cache', "Cache json dump", function(){
    return fs.writeFileSync(deltosHome + 'deltos.cache.json', dumpJson());
  });
  addCommand('todos', "Dump todo list", function(){
    return console.log(dumpTodos());
  });
  addCommand('tagged', "Dump TSV for posts with tag", function(it){
    return console.log(dumpTsvTagged(it));
  });
  addCommand('tsv', "Dump basic TSV", function(){
    return console.log(dumpTsv());
  });
  addCommand('version', "Show version number", function(){
    var pkg;
    pkg = require('../package.json');
    return console.log(pkg.version);
  });
  addCommand('help', "Show this help", function(){
    var name, ref$, func;
    console.log("usage: deltos <command> [options...]\n");
    for (name in ref$ = commands) {
      func = ref$[name];
      console.log("\t" + func.command + "\t\t" + func.desc);
    }
    return process.exit(1);
  });
  try {
    func = commands[process.argv[2]];
  } catch (e$) {
    e = e$;
    func = commands.help();
  }
  if (!func) {
    func = commands.help;
  }
  func.apply(null, process.argv.slice(3));
}).call(this);
